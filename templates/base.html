<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}JO Tickets - Billets Jeux Olympiques{% endblock %}</title>
    {% load static %}

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'images/icons/apple-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'images/icons/apple-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'images/icons/apple-icon-72x72.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'images/icons/apple-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'images/icons/apple-icon-114x114.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/icons/apple-icon-120x120.png' %}">
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'images/icons/apple-icon-144x144.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/icons/apple-icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/icons/apple-icon-180x180.png' %}">
    <link rel="icon" type="image/png" sizes="192x192"  href="{% static 'images/icons/android-icon-192x192.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/icons/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/icons/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/icons/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/icons/manifest.json' %}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{% static 'images/icons/ms-icon-144x144.png' %}">
    <meta name="theme-color" content="#ffffff">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Varela+Round&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <!-- HTML5 QR Code Scanner -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/simple.css' %}">

</head>
<body class="body">
<!-- Navigation -->
<div class="nav" id="navbar">
    <div class="nav-content">
        <a href="{% url 'users:home' %}" class="logo">
            JO Tickets
        </a>

        <!-- Desktop menu -->
        <div class="nav-menu">
            <a href="{% url 'users:home' %}" >Accueil</a>
            <a href="{% url 'catalog:offers' %}" >Offres</a>


            {% if user.is_employee %}
            <a href="{% url 'control:scan' %}">Scanner</a>
            {% endif %}
            {% if user.is_adminpanel %}
            <a href="{% url 'adminpanel:dashboard' %}">Administration</a>
            {% endif %}
        </div>

        <!-- User menu -->
        <div class="nav-user">
            {% if user.is_authenticated %}
            <a href="{% url 'cart:cart' %}" title="Panier" class="nav-cart">
                <i class="fa-solid fa-cart-shopping"></i>
                <span id="cart-counter" class="badge">{{ cart_items_count }}</span>
            </a>
            <div class="user-dropdown">
                <button class="btn user-btn">
                    <div class="user-avatar">
                        {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                    </div>
                    {{ user.get_full_name }}
                </button>
                <div class="dropdown">
                    <a href="{% url 'users:profile' %}" class="dropdown-item">Mon Profil</a>
                    <a href="{% url 'tickets:my_tickets' %}" class="dropdown-item">Mes Billets</a>
                    <hr>
                    <a href="{% url 'users:logout' %}" class="dropdown-item">Déconnexion</a>
                </div>
            </div>
            {% else %}
            <a href="{% url 'users:login' %}" class="btn">Connexion</a>
            <a href="{% url 'users:signup' %}" class="btn btn-primary">Inscription</a>
            {% endif %}
        </div>

        <!-- Mobile menu button -->
        <button class="btn-mobile" onclick="toggleMobileMenu()">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>

    <!-- Mobile menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="{% url 'users:home' %}" class="dropdown-item">Accueil</a>
        <a href="{% url 'catalog:offers' %}" class="dropdown-item">Offres</a>
        {% if user.is_authenticated %}
        <a href="{% url 'cart:cart' %}" class="dropdown-item">
            Panier <span id="cart-counter-mobile" class="badge">{{ cart_items_count }}</span>
        </a>
        <a href="{% url 'tickets:my_tickets' %}" class="dropdown-item">Mes Billets</a>
        {% endif %}
        {% if user.is_employee %}
        <a href="{% url 'control:scan' %}" class="dropdown-item">Scanner</a>
        {% endif %}
        {% if user.is_adminpanel %}
        <a href="{% url 'adminpanel:dashboard' %}" class="dropdown-item">Administration</a>
        {% endif %}

        {% if user.is_authenticated %}
        <a href="{% url 'users:profile' %}" class="btn">Mon Profil</a>
        <a href="{% url 'users:logout' %}" class="btn-primary btn">Déconnexion</a>
        {% else %}
        <a href="{% url 'users:login' %}" class="btn">Connexion</a>
        <a href="{% url 'users:signup' %}" class="btn-primary btn">Inscription</a>
        {% endif %}
    </div>
</div>

<!-- Flash Messages -->
{% if messages %}
    {% for message in messages %}
        {% if not '/connexion/' in request.path or message.tags != 'error' %}
        <div class="alert alert-{{ message.tags|default:'info' }}">
            <span>{{ message }}</span>
        </div>
        {% endif %}
    {% endfor %}
{% endif %}

<!-- Main Content -->
<main class="main-content">
    {% block content %}
    {% endblock %}
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="{% url 'users:construction' %}" class="footer-link" target="_blank">À propos</a>
            <a href="{% url 'users:construction' %}" class="footer-link" target="_blank">Contact</a>
            <a href="{% url 'users:construction' %}" class="footer-link" target="_blank">Mentions légales</a>
            <a href="{% url 'users:construction' %}" class="footer-link" target="_blank">CGV</a>
        </div>
    </div>
    <div class="footer-copyright">
        <p>© 2024 JO Tickets - Tous droits réservés</p>
    </div>
</footer>

<!-- Custom JavaScript -->
<script>
    // Global configuration
    window.CSRF_TOKEN = '{{ csrf_token }}';

    // Utility functions
    function showAlert(message, type = 'info') {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} mb-4`;
        alertDiv.innerHTML = `<span>${message}</span>`;

        const container = document.querySelector('.container');
        if (container) {
            container.insertBefore(alertDiv, container.firstChild);
        }

        // Auto-remove after 5 seconds
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }

    function formatPrice(price) {
        return new Intl.NumberFormat('fr-FR', {
            style: 'currency',
            currency: 'EUR'
        }).format(price);
    }

    function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    function updateCartCounter(count) {
        // Update desktop counter
        const cartCounter = document.getElementById('cart-counter');
        if (cartCounter) {
            cartCounter.textContent = count;
            cartCounter.classList.remove('hidden');
        }

        // Update mobile counter
        const cartCounterMobile = document.getElementById('cart-counter-mobile');
        if (cartCounterMobile) {
            cartCounterMobile.textContent = count;
            cartCounterMobile.classList.remove('hidden');
        }
    }

       // Mobile menu toggle
       function toggleMobileMenu() {
           const mobileMenu = document.getElementById('mobileMenu');
           const btnMobile = document.querySelector('.btn-mobile');
           
           if (mobileMenu) {
               mobileMenu.classList.toggle('show');
               
               // Changement de couleur du bouton burger
               if (btnMobile) {
                   btnMobile.classList.toggle('active');
               }
           }
       }

    // Close mobile menu when clicking outside or on a link
    document.addEventListener('click', function (event) {
        const mobileMenu = document.getElementById('mobileMenu');
        const btnMobile = document.querySelector('.btn-mobile');

        if (mobileMenu && btnMobile && !mobileMenu.contains(event.target) && !btnMobile.contains(event.target)) {
            mobileMenu.classList.remove('show');
            btnMobile.classList.remove('active');
        }
        
        // Close menu when clicking on a mobile menu link
        if (event.target.classList.contains('dropdown-item')) {
            mobileMenu.classList.remove('show');
            btnMobile.classList.remove('active');
        }
    });

    // Transparent navbar scroll effect
    function handleNavbarScroll() {
        const navbar = document.getElementById('navbar');
        if (navbar) {
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        }
    }

    // Add scroll event listener
    window.addEventListener('scroll', handleNavbarScroll);

    // Initialize navbar state
    document.addEventListener('DOMContentLoaded', function () {
        handleNavbarScroll();
    });
</script>

{% block extra_js %}
{% endblock %}
</body>
</html>
